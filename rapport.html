<?php
$host = 'localhost';
$dbname = 'nom_de_votre_base';
$username = 'utilisateur_db';
$password = 'mot_de_passe_db';

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("Erreur de connexion : " . $e->getMessage());
}
?>
<?php include 'config.php'; ?>

<form method="POST">
    Date : <input type="date" name="date_activite" required><br>
    Type : <input type="text" name="type_activite" required><br>
    Lieu : <input type="text" name="lieu" required><br>
    Participants : <input type="number" name="nb_participants" required><br>
    Responsable : <input type="text" name="responsable" required><br>
    <input type="submit" name="envoyer" value="Ajouter">
</form>

<?php
if (isset($_POST['envoyer'])) {
    $sql = "INSERT INTO activites (date_activite, type_activite, lieu, nb_participants,mt_epargne, responsable)
            VALUES (?, ?, ?, ?, ?)";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([
        $_POST['date_activite'],
        $_POST['type_activite'],
        $_POST['lieu'],
        $_POST['nb_participants'],
$_POST['mt_epargne'],
        $_POST['responsable']
    ]);
    echo "Activité ajoutée avec succès.";
}
?>
<?php include 'config.php'; ?>

<h2>Liste des Activités</h2>
<table border="1">
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Lieu</th>
        <th>Participants</th>
      <th>Epargne</th>
        <th>Responsable</th>
    </tr>
    <?php
    $sql = "SELECT * FROM activites ORDER BY date_activite DESC";
    foreach ($pdo->query($sql) as $row) {
        echo "<tr>
            <td>{$row['date_activite']}</td>
            <td>{$row['type_activite']}</td>
            <td>{$row['lieu']}</td>
            <td>{$row['nb_participants']}</td>
  <td>{$row['mt_epargne']}</td>
            <td>{$row['responsable']}</td>
        </tr>";
    }
    ?>
</table>
<?php
$sql = "SELECT DATE_FORMAT(date_activite, '%Y-%m') AS mois, COUNT(*) AS total 
        FROM activites GROUP BY mois ORDER BY mois";
$data = $pdo->query($sql)->fetchAll(PDO::FETCH_ASSOC);

$labels = [];
$values = [];
foreach ($data as $row) {
    $labels[] = $row['mois'];
    $values[] = $row['total'];
}
?>
<canvas id="graph" width="600" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('graph').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: <?= json_encode($labels) ?>,
            datasets: [{
                label: 'Activités par mois',
                data: <?= json_encode($values) ?>,
                backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
        }
    });
</script>

  
